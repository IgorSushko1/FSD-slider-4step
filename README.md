# IS-slider

# Навигация:

- [IS-slider](#is-slider)
- [Навигация:](#Навигация)
	- [Achievement](#achievement)
	- [В проекте используются:](#В-проекте-используются)
	- [is_slider](#is_slider)
		- [Установка](#Установка)
		- [Описание передаваемых параметров в объекте `tuning`](#Описание-передаваемых-параметров-в-объекте-tuning)
	- [Описание архитектуры](#Описание-архитектуры)
	- [Модель](#Модель)
		- [Описание](#Описание)
		- [Методы](#Методы)
			- [_set_model(obj)](#_set_modelobj)
			- [_get_model(obj)](#_get_modelobj)
	- [Контроллер](#Контроллер)
		- [Описание](#Описание-1)
		- [Методы](#Методы-1)
			- [_get_model()](#_get_model)
			- [_get_view()](#_get_view)
			- [_set_model(obj)](#_set_modelobj-1)
			- [_set_view(obj)](#_set_viewobj)
	- [Вид](#Вид)
		- [Описание](#Описание-2)
		- [Методы](#Методы-2)
			- [create_stuff()](#create_stuff)
			- [create_this_sliders_elements()](#create_this_sliders_elements)
			- [move_ribon()](#move_ribon)
			- [set_visible_text_field()](#set_visible_text_field)
			- [move_sliders_on_inizialization()](#move_sliders_on_inizialization)
			- [move_single_slider_on_inizialization()](#move_single_slider_on_inizialization)
			- [_create_listeners()](#_create_listeners)
			- [_mouse_down_single](#_mouse_down_single)
			- [_move_element_single](#_move_element_single)
			- [_math__sliders_value_single(this.pixel_step, e);](#_math__sliders_value_singlethispixel_step-e)
			- [refresh_positions()](#refresh_positions)
			- [_mouse_down_first_slider](#_mouse_down_first_slider)
			- [_mouse_down_second_slider](#_mouse_down_second_slider)
			- [_move_element_1](#_move_element_1)
			- [_move_element_2](#_move_element_2)
			- [_step_implementation(e: MouseEvent,	modified_object: HTMLElement, static_object?: HTMLElement)](#_step_implementatione-mouseeventmodified_object-htmlelement-static_object-htmlelement)
			- [_math__sliders_value_left()](#_math__sliders_value_left)
			- [_math__sliders_value_right(e: MouseEvent)](#_math__sliders_value_righte-mouseevent)
			- [_math__sliders_value_single_step(steps: number, e: MouseEvent)](#_math__sliders_value_single_stepsteps-number-e-mouseevent)
			- [_math__sliders_value_left_step(steps: number, pixel_step: number, e: MouseEvent)](#_math__sliders_value_left_stepsteps-number-pixel_step-number-e-mouseevent)
			- [_math__sliders_value_right_step(steps: number, pixel_step: number, e: MouseEvent)](#_math__sliders_value_right_stepsteps-number-pixel_step-number-e-mouseevent)
			- [_cancel_move_events](#_cancel_move_events)

## Achievement

Для выполнения этого проекта были прочитаны:

+ "JavaScript Карманный справочник" Дэвида Флэнагана

+ "JavaScript Сильные стороны" Дугласа Крокфорда

+ "Programming TypeScript" by Boris Cherny

+ "Чистая архитектура. Искусство разработки программного обеспечения" Роберта Мартина

+ и множество прекрасных статей :)

Мной впервые были применены typescript, jsdom, mocha, chai.

А так же один учебный проект на котором я разобрал тестирование.

[⇱](#Навигация "Навигация")

## В проекте используются:

+ Webpack
+ Node.js
+ ts-node
+ TypeScript
+ Mocha
+ Chia
+ JSDOM
+ HTML
+ CSS

[⇱](#Навигация "Навигация")

## is_slider

### Установка

Необходимо скачать папку `is_slider` с js или ts файлами и импортировать её в ваш главный js/ts файл. Плагин не использует сторонние библиотеки! Затем в вашем файле прописать `import {is_slider} from "../is_slider";` и передать ему необходимые параметры:

>`is_slider(id: string, tuning: object, id_settings: string)`
>
>`id: string` -- в это поле необходимо поместить id того элемента `div`, в котором должен быть создан слайдер. Для расчетов значений слайдера используется ширина или высота указанного родительского элемента.
>
>`tuning: object` -- в этом объекте хранятся данные, которые при желании можно изменить, в соответствии которым производится построение слайдера.
>
>`id_settings: string` -- здесь, при желании использования быстрых настроек, необходимо разместить id элемента `div`, в котором будет создана панель для быстрых настроек слайдера.

[⇱](#Навигация "Навигация")

### Описание передаваемых параметров в объекте `tuning`

```
{
	_sign: "₽",//"₽", "$", "€", "¥", "Ұ", "£" -- знак валюты(любое строковое значение), отобразится в поле над ползунком при наведении на слайдер, и в статичном поле.

	_min_start_slider: 0,// - минимальное значение шкалы слайдера

	_max_start_slider: 1000,// - максимальное значение шкалы слайдера

	_min_slider_value: 200,// - значение первого или единственного слайдера, при инициализации слайдер будет установлен в это положение

	_max_slider_value: 800,// - значение второго слайдера,  при инициализации слайдер будет
	 					   // установлен в это положение, цифра должна быть больше значения для первого слайдера

	_slider_type: "duble",//"duble" or "single" - двойной или одиночный слайдер

	_type_view: "horizontal",//"horizontal" or "vertocal" - горизонтальный или вертикальный вид слайдера

	_step: 50,// - шаг слайдера

	tooltip: "on",//"on" or "off" - отображает/скрывает поле с цифрами над ползунками

	value_field: "on",//"on" or "off" - отображает/скрывает статичное поле с цифрами
}
```

[⇱](#Навигация "Навигация")

## Описание архитектуры

[⇱](#Навигация "Навигация")

Инициализацию плагина выполняет функция ias-slider, которая запускает плагин с параметрами, заданными программистом. При наличии в родительском элементе дочернего с заданным settings_id, ias-slider отобразит интерфейс для быстрого изменения настроек слайдера.

Архитектура плагина реализована по методике MVC.

Модель представляет собой объект, хранящий данные о максимальной и минимальной доступной цене, знаке валюты, а так же о том, какие значения были установлены посетителем сайта. Модель содержит методы, позволяющие обновить данные и вызвать заинтересованную службу для дальнейшей выгрузки данных.

Контроллер "видит" Модель и Вид, забирает необходимые данные из Модели и переносит их в Вид, запускает построение слайдера на странице. При манипуляциях пользователя с Видом Контроллер по вызову забирает новые данные и переносит их в Модель.

Вид отвечает за построение графической части, содержит логику работы плагина. С построенным Видом взаимодействует пользователь. При манипуляциях пользователя Вид вызывает метод Контроллера для сбора необходимых данных.

## Модель

### Описание


Если следовать описанию, которое дал Роберт Мартин в книге "Чистая архитектура", под моделью(бизнес-логикой) понимаются те процессы и данные, которые существуют вне программирования, компьютеров. В слайдере этими процессами и данными являются деньги. У продавца есть товар в определенном диапазоне средств. У покупателя есть желание и потребность купить определенный товар за определенные деньги. Эти четыре параметра - границы возможностей продавца и покупателя и являются бизнес-логикой. Далее у нас есть определенная валюта т.к. слайдер может использоваться в разных странах. В этом слайдере модель содержит объект, хранящий перечисленные выше параметры, и фасад, с помощью которого контроллер может вносить изменения в модель и брать значения из вида.

[⇱](#Навигация "Навигация")

### Методы

#### _set_model(obj)

>Arguments:
>
>`obj` - содержит такие ключи как: `_min_start_slider`, `_max_start_slider`, `_min_slider_value`, `_max_slider_value`, `_sing`. При первой инициализации принимает эти параметры от функции `_facade_isslider-model()` из функции `is_slider`. Далее с ним работает Контроллер и передает только пользовательские данные. Познакомится с описанием ключей объекта можно по ссылке [Описание передаваемых параметров в объекте `tuning`](#Описание-передаваемых-параметров-в-объекте-tuning)

#### _get_model(obj)

>Arguments:
>
>`obj` - содержит такие ключи как: `_min_start_slider`, `_max_start_slider`, `_min_slider_value`, `_max_slider_value`. При первой инициализации отдаёт эти параметры функции `_facade_model-controller()` в функции `is_slider`. Далее с ним работает Контроллер и передает только пользовательские данные. Познакомится с описанием ключей объекта можно по ссылке [Описание передаваемых параметров в объекте `tuning`](#Описание-передаваемых-параметров-в-объекте-tuning)

[⇱](#Навигация "Навигация")

## Контроллер

### Описание

Контроллер занимается тем, что при изменении информации в виде передаёт её в модель. Так же в Контроллере находится метод для инициализации вида, с параметрами, полученными, частично, напрямую от функции is_slider, а частично из модели. Хотя можно было бы обойтись и одними данными из is_slider, но архитектура требует разделения данных на части относящиеся к бизнес-логике и к виду, с которым взаимодействует пользователь. Контроллер при инициализации получает объект от is_slider, который содержит данные относящиеся к виду.

### Методы

#### _get_model()

Берет все значения из модели.

#### _get_view()

Берет значения ползунков после того, как их передвинул пользователь и перезаписывает внутренний объект контроллера.

#### _set_model(obj)

>Arguments:
>
>`obj` - содержит такие ключи как: `_min_slider_value`, `_max_slider_value`. Отправляет их в модель для записи в объект с информацией. Познакомится с описанием ключей объекта можно по ссылке [Описание передаваемых параметров в объекте `tuning`](#Описание-передаваемых-параметров-в-объекте-tuning)

Отправляет новые данные в модель.


#### _set_view(obj)

>Arguments:
>
>`obj` - содержит все ключи. Познакомится с описанием ключей объекта можно по ссылке [Описание передаваемых параметров в объекте `tuning`](#Описание-передаваемых-параметров-в-объекте-tuning)

Отправляет их в вид для инициализации слайдера.

## Вид

[⇱](#Навигация "Навигация")

### Описание

Создает слайдер в указанном по id элементе.

### Методы

#### create_stuff()
Проверяет наличие элемента с указанным id для создания слайдера.
Создает HTML элементы двойного или одинарного слайдера в зависимости от переданных параметров.

>После обращается к методам
>
>`create_this_sliders_elements();`
>
>`move_ribon();`
>
>`set_visible_text_field();`
>
>`_create_listeners();`

[⇱](#Навигация "Навигация")


#### create_this_sliders_elements()
Сообщает переменным класса значения типа HTMLElement, к этим переменным далее будут обращаться другие методы.

[⇱](#Навигация "Навигация")

#### move_ribon()

>`refresh_positions();`

Совмещает координаты полоски и слайдеров или координаты начала и слайдера(если слайдер одиночный).

[⇱](#Навигация "Навигация")

#### set_visible_text_field()

В зависимости от того двойной слайдер или одиночный:
	Проверяет условие, что все элементы подчинены логике и ни одно из значений не является больше или меньше, чем оно должно быть
	Присваивает текстовым полям(придназначенным для отображения денежного диапазона) значения
	Проверяет необходимость показа или скрытия текстовых полей, соответственно показывает или скрывает

>После обращается к методам
>
>`move_sliders_on_inizialization();`
>
>`move_single_slider_on_inizialization();`

[⇱](#Навигация "Навигация")

#### move_sliders_on_inizialization()

Переводит слайдеры в начальное положение по исходных данным

[⇱](#Навигация "Навигация")

#### move_single_slider_on_inizialization()

Переводит слайдер в начальное положение по исходных данным

[⇱](#Навигация "Навигация")

#### _create_listeners()

В зависимости от того двойной слайдер или одинарный ссылается на методы инициализации событий

>При событии нажатия на одинарный ползунок вызвает метод
>
>`_mouse_down_single`

>При событии нажатия на один из ползунков вызвает соответствующий метод
>
>`_mouse_down_first_slider`
>
>`_mouse_down_second_slider`

[⇱](#Навигация "Навигация")

#### _mouse_down_single

>Arguments:
>
>`event`
>
>`e.preventDefault()` - отменяет любые действия браузера связанные с этим элементом

>При событии движения мыши запускает метод
>
>`_move_element_single`

>При событии отпускания клавиши мыши запускает метод
>
>`_cancel_move_events`

[⇱](#Навигация "Навигация")

#### _move_element_single

>Arguments:
>
>event

Если:
+ Шаг слайдера больше размера ползунка, то запустит
+	>`_step_implementation(e, this.parent_element, this.slider_single);`

Иначе:

+ Если Координаты мыши выходят за рамки элемента слайдера, то ползунок встает в крайнее положение

+ Иначе Если Координаты мыши меньше координат начала элемента слайдера, то ползунок встает в нулевое положение

+ Иначе Ползунок перемещается за мышью.

+  >Вызвает методы:
     >
     >`refresh_positions();`
     >
     >`_math__sliders_value_single(this.pixel_step, e);`

>После вызывает метод:
>
>`move_ribon();`

[⇱](#Навигация "Навигация")

#### _math__sliders_value_single(this.pixel_step, e);
>Arguments
>
>`e`
>
>`this.pixel_step`

 >`refresh_positions();`

Если:

+ Координаты мыши за пределами слайдера, то
в поля помещаются минимальные/максимальные значения

Иначе

+ В поля помещаются вычисляемые значения в зависимости от положения ползунка

Сдвиг всплывающей подсказки за ползунком

[⇱](#Навигация "Навигация")

#### refresh_positions()

Обновляет переменную родительского элемента слайдера, и его позицию - это понадобится в случае если пользователь изменит разрешение экрана во время просмотра страницы или увеличит/уменьшит страницу.

Обновляет переменные, содержащие положение по осям X или Y, ползунков или ползунка

[⇱](#Навигация "Навигация")

#### _mouse_down_first_slider

>Arguments:
>
>`event`

>`e.preventDefault()`

>При событии движения мыши запускает метод
>
>`_move_element_1`

>При событии отпускания клавиши мыши запускает метод
>
>`_cancel_move_events`

[⇱](#Навигация "Навигация")

#### _mouse_down_second_slider


>Arguments:
>
>`event`

>`e.preventDefault()`

>При событии движения мыши запускает метод
>
>`_move_element_2`

>При событии отпускания клавиши мыши запускает метод
>
>`_cancel_move_events`

[⇱](#Навигация "Навигация")

#### _move_element_1

>Arguments:
>
>`event`

>`refresh_positions();`

Если

+ Шаг больше заданного размера, то запускается

+ >`_step_implementation(e, this.parent_element, this.slider_1, this.slider_2)`

Иначе

+ Слайдер ведет себя как будто шаг равен 1.

+ >`refresh_positions();`
  >
	>`_math__sliders_value_left(this.pixel_step, e);`

>`move_ribon()`



[⇱](#Навигация "Навигация")

#### _move_element_2

>Arguments:
>
>`event`

>`refresh_positions();`

Если
+ Шаг больше заданного размера, то запускается

+  >`_step_implementation(e, this.parent_element, this.slider_1, this.slider_2)`

Иначе

+ Слайдер ведет себя как будто шаг равен 1

+ >`refresh_positions();`
  >
	>`_math__sliders_value_left(this.pixel_step, e);`

>`move_ribon()`

[⇱](#Навигация "Навигация")

#### _step_implementation(e: MouseEvent,	modified_object: HTMLElement, static_object?: HTMLElement)

>Arguments:
>
>`e: MouseEvent;`
>
>`modified_object: HTMLElement` - ползунок, с которым взаимодействует пользователь
>
>`static_object?: HTMLElement` - ползунок в двойном слайдере, в данный момент остающийся статичным

>`refresh_positions();`

Если есть `static_object`

+ Если modified_object расположен перед static_object
	+ Манипуляции с ползунком в зависимости от положения мыши
  
	+ >`.refresh_positions();`
	+ >`_math__sliders_value_left_new(step, pixel_step, e);`

+ Если modified_object расположен после static_object
  
	+ Манипуляции с ползунком в зависимости от положения мыши
  + >`.refresh_positions();`

  + >`_math__sliders_value_right_new(step, pixel_step, e);`

Если static_object осутствует

+ Манипуляции с ползунком в зависимости от положения мыши

+ >`.refresh_positions();`

+ >`_math__sliders_value_single_step(step, pixel_step, e);`

[⇱](#Навигация "Навигация")

#### _math__sliders_value_left()

Вычисляет значения для помещения в поля, перемещает всплывающую подсказку

[⇱](#Навигация "Навигация")

#### _math__sliders_value_right(e: MouseEvent)

>Arguments:
>
>`e: MouseEvent`

Вычисляет значения для помещения в поля(в зависимости от положения мыши), перемещает всплывающую подсказку

[⇱](#Навигация "Навигация")

#### _math__sliders_value_single_step(steps: number, e: MouseEvent)

>Arguments:
>
>`steps: number` - это значение конкретного шага, на котором остановился ползунок;
>
>`e: MouseEvent;`

Вычисляет значение шага, помещает его в поля и перемещает всплывающую подсказку

[⇱](#Навигация "Навигация")

#### _math__sliders_value_left_step(steps: number, pixel_step: number, e: MouseEvent)

>Arguments:
>
>`step: number` - это шаг, на котором пользователь остановил ползунок. Округляется до целого числа.
>
>`pixel_step: number` - это размер шага в пикселях, отличается от другого шага тем, что у этого из ширины/высоты родительского элемента вычтена ширина/высота ползунка, что не дает выйти ползунку за пределы границ родительского элемента;
>
>e: MouseEvent;

Вычисляет значение, на котором остановился пользователь, отображает это значение в динамичных и статичных полях, поля следуют за ползунком.

[⇱](#Навигация "Навигация")

#### _math__sliders_value_right_step(steps: number, pixel_step: number, e: MouseEvent)

>Arguments:
>
>`step: number` - это шаг, на котором пользователь остановил ползунок. Округляется до целого числа.
>
>`pixel_step: number` - это размер шага в пикселях, отличается от другого шага тем, что у этого из ширины/высоты родительского элемента вычтена ширина/высота ползунка, что не дает выйти ползунку за пределы границ родительского элемента;
>
>`e: MouseEvent`;

Вычисляет значение, на котором остановился пользователь, отображает это значение в динамичных и статичных полях, поля следуют за ползунком.

[⇱](#Навигация "Навигация")

#### _cancel_move_events

Срабатывает при поднятии клавиши мыши, аннулирует все прослушки событий.

[⇱](#Навигация "Навигация")